<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="api.macro('kotti:templates/view/master.pt')">

  <article metal:fill-slot="content"
           class="content"
           i18n:domain="kotti_eshop">

    <h2>Checkout</h2>
  	<p>Form client, address</p>
    <p tal:content="structure view.form_description() | default"></p>
    <form tal:replace="structure form" />

    <!-- for tests -->
    <h4>For tests [TODO] Remove me:</h4>
    <div tal:repeat="client api.get_all_clients()">
      <h3>${client.email}</h3>
      <p> created on ${api.format_datetime(client.creation_date)} has cart:</p>
      <ol>
        <li tal:repeat="shopping_cart client.shopping_cart">${shopping_cart.shoppingcart_uid} 
        created on ${api.format_datetime(shopping_cart.creation_date)} with products: 
          <ol>
            <tal:repeat repeat="content_record shopping_cart.cart_content">
              <li tal:define="product content_record.product">
                ${product.pin} - ${product.title} - ${content_record.quantity} - 
                ${python: float(product.price)} ${api.shop_currency()} - 
                ${python: float(product.price) * content_record.quantity} ${api.shop_currency()}
              </li>
            </tal:repeat>
          </ol>
        </li>
      </ol>
      <h4>addresses:</h4>
      <ol>
        <li tal:repeat="address client.shipping_addresses">
          ${address.address} - created on ${api.format_datetime(address.creation_date)}
        </li>
      </ol>

      <h4>orders:</h4>
      <ol>
        <li tal:repeat="order client.shop_orders">
          ${python: float(order.total_price)} ${api.shop_currency()} - created on ${api.format_datetime(order.creation_date)}
        </li>
      </ol>
    </div>
    <!-- for tests -->
  </article>
</html>