<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="api.macro('kotti:templates/site-setup/master.pt')">

  <div metal:fill-slot="editor-bar"></div>

  <article metal:fill-slot="content"
           class="content"
           i18n:domain="kotti_eshop">

    <h1 i18n:translate="">Global shop settings</h1>

    <div class="row" tal:define="action request.GET.get('action', '');">

      <!-- menu left -->
      <div class="col col-lg-2 col-md-2 col-sm-12 col-xs 12">
        <div class="panel panel-default">
          <div class="panel-heading">Options</div>
          <ul class="list-group">
            <li class="list-group-item">
              <a href="${api.url(api.root,'@@add-product')}">Add a product</a>
            </li>
            <li class="list-group-item">
              <a href="${api.url(api.root,'@@shop_admin')}">Main</a>
            </li>
            <li class="list-group-item">
              <a href="${api.url(api.root,'@@shop_admin')}?action=products">
                Manage products
              </a>
            </li>
            <li class="list-group-item">
              <a href="${api.url(api.root,'@@shop_admin')}?action=clients">
                Manage clients
              </a>
            </li>
            <li class="list-group-item">
              <a href="${api.url(api.root,'@@settings')}">Edit shop settings</a>
            </li>            
          </ul>
        </div>      
      </div><!-- menu left -->

      <div class="col col-lg-10 col-md-10 col-sm-12 col-xs 12">
        <!-- ADMIN MAIN -->
        <tal:condition condition="python: action == ''">
          <h3>Admin main</h3>
          <p>Maybe you want <a href="${api.url(api.root, '@@shop_admin')}?action=products">manage products</a> or
             <a href="${api.url(api.root, '@@shop_admin')}?action=clients">clients</a>
          </p>
          <h4>Shop Settings</h4>
          <p>Currency: ${api.shop_currency()}</p>
          <p>You can change these <a href="${api.url(api.root, '@@settings')}">settings in Shop settings tab</a>.</p>
        </tal:condition>
        <!-- ADMIN MAIN -->

        <!-- CLIENTS -->
        <tal:condition condition="python: action == 'clients'">
          <h3>Clients</h3>
          <table class="table table-condensed">
            <thead>
              <tr>
                <th>ID</th>
                <th>Nickname (Fullname)</th>
                <th>Email (Paypal email)</th>
                <th>Deliver Address</th>
                <th>Status</th>
                <th>Last IP login</th>
                <th>Options</th>
              </tr>
            </thead>
            <tbody>
              <tr tal:repeat="client shop_clients">
                <td>${client.id}</td>
                <td>
                  <a href="${api.url(client)}">${client.nickname}</a> (${client.fullname})
                </td>
                <td>
                  ${client.email} (${client.paypal_email})
                </td>
                <td>${client.deliver_address}</td>
                <td>${client.status}</td>
                <td>${client.last_ip_login}</td>
                <td>
                  <a class="btn btn-xs btn-warning" href="${api.url(client, '@@edit')}">Edit</a>
                  <a class="btn btn-xs btn-danger" href="${api.url(client, '@@delete')}">Delete</a>
                  <a class="btn btn-xs btn-primary" href="${api.url(client, '@@cart')}">View cart</a>
                </td>
              </tr>
            </tbody>
          </table>
        </tal:condition>
        <!-- CLIENTS -->

        <!-- PRODUCTS -->
        <tal:condition condition="python: action == 'products'">
          <h3>Backend products</h3>
          <table class="table table-condensed">
            <thead>
              <tr>
                <th>Product ID</th>
                <th>Title</th>
                <th>Description</th>
                <th>Assigned to</th>
                <th>Price</th>
                <th>Options</th>
              </tr>
            </thead>
            <tbody>
              <tr tal:repeat="product api.get_all_backend_products()">
                <td>${product.product_id}</td>
                <td>${product.title}</td>
                <td>${product.description}</td>
                <td>
                  <a tal:repeat="content_item product.assigned_content"
                     href="api.url(content_item)">
                    ${content_item.title}
                  </a>
                </td>
                <td>${python: float(product.price)} ${api.shop_currency()}</td>
                <td>
                  <a class="btn btn-sm btn-warning" href="#edit-link">Edit</a>
                  <form method="POST" action="${request.resource_url(api.root, '@@shop_admin')}">
                    <button class="btn btn-sm btn-danger" name="delete_backend_product">Delete</button>
                    <input type="hidden" name="backend_product_id" value="${product.id}">
                  </form>
                </td>
              </tr>
            </tbody>
          </table>
        </tal:condition>
        <!-- PRODUCTS -->
      </div>      
    </div>
  </article>
</html>
