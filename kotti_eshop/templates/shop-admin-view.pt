<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xml:lang="en"
      xmlns:i18n="http://xml.zope.org/namespaces/i18n"
      xmlns:tal="http://xml.zope.org/namespaces/tal"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      metal:use-macro="api.macro('kotti:templates/view/master.pt')">

  <article metal:fill-slot="content"
           class="content"
           i18n:domain="kotti_eshop"
           tal:define="shop context">

    <h1 class="shop-title">
      <a href="${api.url(shop)}">
        ${shop.title}
      </a> - 
      <a href="${api.url(shop, '@@admin')}">
        ${custom_page_title}
      </a>
    </h1>

    <div class="row"
         tal:define="action request.GET.get('action', '');
                     shop_currency shop.currency()">
      <!-- menu left -->
      <div class="col col-lg-2 col-md-2 col-sm-12 col-xs 12">
        <div class="panel panel-default">
          <div class="panel-heading">Options</div>
          <ul class="list-group">
            <li class="list-group-item">
              <a href="${api.url(shop,'@@admin')}">Main</a>
            </li>
            <li class="list-group-item">
              <a href="${api.url(shop,'@@admin')}?action=products">
                Manage products
              </a>
            </li>
            <li class="list-group-item">
              <a href="${api.url(shop,'@@admin')}?action=clients">
                Manage clients
              </a>
            </li>
            <li class="list-group-item">
              <a href="${api.url(shop,'@@edit')}">Edit basic details</a>
            </li>
            <li class="list-group-item">
              <a href="${api.url(shop,'@@contents')}">Edit products</a>
            </li>
            <li class="list-group-item">
              <a href="${api.url(api.root,'@@settings')}">Edit shop settings</a>
            </li>            
          </ul>
        </div>      
      </div><!-- menu left -->

      <div class="col col-lg-10 col-md-10 col-sm-12 col-xs 12">
        <!-- ADMIN MAIN -->
        <tal:condition condition="python: action == ''">
          <h3>Admin main</h3>
          <p>Maybe you want <a href="${api.url(shop, '@@admin')}?action=products">manage products</a> or
             <a href="${api.url(shop, '@@admin')}?action=clients">clients</a>
          </p>
          <h4>Shop Settings</h4>
          <p>Currency: ${shop.currency()}</p>
          <p>Products per page: ${shop.products_per_page()}</p>
          <p>You can change these <a href="${api.url(api.root, '@@settings')}">settings in Shop settings tab</a>.</p>
        </tal:condition>
        <!-- ADMIN MAIN -->

        <!-- CLIENTS -->
        <tal:condition condition="python: action == 'clients'">
          <h3>Clients</h3>
          <table class="table table-condensed">
            <thead>
              <tr>
                <th>Nickname (Fullname)</th>
                <th>Email (Paypal email)</th>
                <th>Deliver Address</th>
                <th>Status</th>
                <th>Last IP login</th>
                <th>Options</th>
              </tr>
            </thead>
            <tbody>
              <tr tal:repeat="client shop.get_all_clients()">
                <td>
                  ${client.nickname} (${client.fullname})
                </td>
                <td>
                  ${client.email} (${client.paypal_email})
                </td>
                <td>${client.deliver_address}</td>
                <td>${client.status}</td>
                <td>${client.last_ip_login}</td>
                <td>
                  <a class="btn btn-sm btn-warning" href="${api.url(client, '@@edit')}">Edit</a>
                  <a class="btn btn-sm btn-danger" href="${api.url(client, '@@delete')}">Delete</a>
                </td>
              </tr>
            </tbody>
          </table>
        </tal:condition>
        <!-- CLIENTS -->

        <!-- PRODUCTS -->
        <tal:condition condition="python: action == 'products'">
          <h3>Products</h3>
          <table class="table table-condensed">
            <thead>
              <tr>
                <th>Name, description, images</th>
                <th>Price</th>
                <th>Support days</th>
                <th>Featured</th>
                <th>Status (Quantity)</th>
                <th>Options</th>
              </tr>
            </thead>
            <tbody>
              <tr tal:repeat="product products">
                <td><b>${product.title}</b> - ${product.description}
                  <div class="product-gallery">
                    <div class="product-image-div"
                         tal:repeat="productimage product.get_all_images().all()">
                      <img width="150px" tal:condition="productimage.data" class="product-image"
                       src="${request.resource_url(productimage)}image" />
                    </div>
                  </div>
                </td>
                <td tal:define="has_price_offer python: product.price_offer and product.expires_offer_date >= today">
                  <!-- simple price -->
                  <h4 class="price-simple" tal:condition="has_price_offer is not True">${product.price} ${shop_currency}</h4>

                  <!-- or old price + new price -->
                  <h5 class="price-offer-old-price" tal:condition="has_price_offer">
                    <del>${product.price} ${shop_currency}</del>
                  </h5>
                  <p tal:condition="has_price_offer">
                    <h4 class="price-offer">${product.price_offer} ${shop_currency}</h4>
                    <h5>(until ${api.format_date(product.expires_offer_date)})</h5>
                  </p>
                </td>
                <td>${product.support_days}</td>
                <td>
                  <span tal:condition="product.featured is True">yes</span>
                  <span tal:condition="product.featured is not True">no</span>
                </td>
                <td>${product.status} (${product.quantity})</td>
                <td>
                  <a class="btn btn-sm btn-warning" href="${api.url(product, '@@edit')}">Edit</a>
                  <a class="btn btn-sm btn-primary" href="${api.url(product, '@@edit_price_offer')}">
                    Offer
                  </a>
                  <a class="btn btn-sm btn-danger" href="${api.url(product, '@@delete')}">Delete</a>
                </td>
              </tr>
            </tbody>
          </table>
        </tal:condition>
        <!-- PRODUCTS -->
      </div>      
    </div>
  </article>
</html>